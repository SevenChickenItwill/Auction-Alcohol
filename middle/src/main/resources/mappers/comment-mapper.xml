<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mid.alcohol.repository.CommentRepository">
    
    <!-- PK ID로 댓글 읽어오기 -->
    <select id = "selectById"
        resultType="com.mid.alcohol.domain.DealReply">
        select * from DEALREPLIES where ID = #{id}
        </select>
    
    <!-- DEAL ID로 댓글 읽어오기 -->
    <select id="selectByDealId"
        resultType="com.mid.alcohol.domain.DealReply">
        select * from DEALREPLIES
        where DEAL_ID = #{deal_id}
        order by MODIFIED_TIME desc
    </select>
    

    <!-- 댓글 수정 -->
    <update id="update">
        update DEALREPLIES
        set CONTENT = #{content}, TIME = systimestamp
        where ID = #{id}
    </update>

    <!-- 댓글 삭제 -->  
    <delete id="delete">
        delete from DEALREPLIES
        where ID = #{id}
    </delete>

    <!-- 댓글 생성 -->
    <insert id="insert">
        insert into DEALREPLIES (deal_id, user_nickname, user_id, user_ranking, content, time) <!-- 디비 필드명 일치 -->
            values (#{deal_id}, #{user_nickname}, #{user_id}, #{user_ranking}, #{content}, systimestamp) <!-- 모델 이름과 완벽히 일치 --> 
    </insert>    
    
    <!-- 달린 댓글 갯수 세기 -->
    <select id="selectCommentCountWithDealId"
        resultType="java.lang.Long">
        select count(*) from DEALREPLIES
        where DEAL_ID = #{deal_id}
        </select>


</mapper>