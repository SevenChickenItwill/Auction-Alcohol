<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mid.alcohol.repository.DealRepository">
    
    <!-- 글 댓글 수 찾기 -->
    <select id="selectWithReplyCount" resultType="com.mid.alcohol.dto.DealListDto">
        select D.ID, D.TITLE, D.NICKNAME, D.USER_ID, D.USER_RANKING, count(R.ID) as RCNT
        from DEAL D left join DEALREPLIES R
            on D.ID = R.DEAL_ID
        group by P.ID, P.TITLE, D.NICKNAME, D.USER_ID, D.USER_RANKING
        order by P.ID desc
    </select>
    
    <!-- 글 작성 -->
    <insert id="dealInsert">
        insert DEAL (title, content, nickname, user_id, user_ranking)
        values (#{title}, #{content}, #{nickname}, #{uersId}, #{userRanking})
    </insert>
    
    
    <!-- 전체 글 목록 보기 -->
    <select id="selectAllOrderByIdDesc" resultType="com.mid.alcohol.domain.Deal">
        select * from DEAL order by ID desc
    </select>
    
    <!-- 하나의 글 상세보기 -->
    <select id="selectById" resultType="com.mid.alcohol.dto.DealDetailDto">
        select * from DEAL where ID = #{id}
    </select>
    
    <!-- 글 수정하기(업데이트) -->
    <update id="dealUpdateById">
        update DEAL
        set TITLE= #{title}, CONTENT= #{content}, MODIFIED_TIME= systimestamp
        where ID= #{id}
    </update>
    
    <!-- 글 삭제하기(delete)2 -->
    <delete id="deleteDealById">
        delete from DEAL where ID = #{id}
    </delete>
    
    
</mapper>