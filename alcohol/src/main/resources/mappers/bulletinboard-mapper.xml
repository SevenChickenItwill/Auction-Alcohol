<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mid.alcohol.repository.BulletinboardRepository">
    
    <!-- 전체 게시글 보기 -->
    <select id="selectAllOrderByIdDesc" resultType="com.mid.alcohol.domain.Bulletinboard">
        select * from BULLETINBOARD order by BOARD_ID desc
    </select>
    
    <!-- 글 작성 -->
    <insert id="bulletinboardInsert">
        insert into BULLETINBOARD (CATEGORY, TITLE, IMAGE, NICKNAME, USER_ID, CONTENT)
        values (#{category}, #{title}, #{image}, #{nickname}, #{user_id}, #{content})
    </insert>
    
    <!-- 게시글 상세보기 -->
    <select id="selectById" resultType="com.mid.alcohol.dto.BulletinboardDetailDto">
        select * from BULLETINBOARD where BOARD_ID = #{board_id}
    </select>
    
    <!-- 글 삭제하기(delete) -->
    <delete id="bulletinboardDeleteById">
        delete from BULLETINBOARD where BOARD_ID = #{board_id}
    </delete>
    
    <!-- 게시글 수정하기(업데이트) -->
    <update id="bulletinboardUpdateById">
        update BULLETINBOARD
        set TITLE= #{title}, IMAGE= #{image}, CONTENT= #{content}, TIME= systimestamp
        where BOARD_ID= #{board_id}
    </update>
    
    <!-- 검색하기 (title, content, title and content, nickname, user_id) -->
    <!-- 글 제목으로 검색하기 -->
    <select id="selectWhereTitle" resultType="com.mid.alcohol.domain.Bulletinboard">
        select * from BULLETINBOARD where lower(TITLE) like lower('%' || #{keyword} || '%') order by BOARD_ID desc
    </select>
    
    <!-- 글 내용으로 검색하기 -->
    <select id="selectWhereContent" resultType="com.mid.alcohol.domain.Bulletinboard">
        select * from BULLETINBOARD where lower(CONTENT) like lower('%' || #{keyword} || '%') order by BOARD_ID desc
    </select>
    
    <!-- 제목과 내용으로 검색하기 -->
    <select id="selectWhereTitleAndContent" resultType="com.mid.alcohol.domain.Bulletinboard">
        select * from BULLETINBOARD 
        where lower(TITLE) like lower('%' || #{keywordT} || '%') or lower(CONTENT) like lower('%' || #{keywordC} || '%') 
        order by BOARD_ID desc
    </select>
    
    <!-- 닉네임으로 검색하기 -->
    <select id="selectWhereNickname" resultType="com.mid.alcohol.domain.Bulletinboard">
        select * from BULLETINBOARD where lower(NICKNAME) like lower('%' || #{keyword} || '%') order by BOARD_ID desc
    </select>
    
    <!-- 유저 아이디로 검색하기 -->
    <select id="selectWhereUserId" resultType="com.mid.alcohol.domain.Bulletinboard">
        select * from BULLETINBOARD where lower(USER_ID) like lower('%' || #{keyword} || '%') order by BOARD_ID desc
    </select>
    
    <!-- 추천업 버튼 -->
    <update id="recommendUp">
    	update BULLETINBOARD
        set RECOMMEND = RECOMMEND + 1
        where BOARD_ID= #{boardId}
    </update>
    
    <!-- 추천다운 버튼 -->
    <update id="recommendDo">
    	update BULLETINBOARD
        set RECOMMEND = RECOMMEND - 1
        where BOARD_ID= #{boardId}
    </update>
    
    <!-- 조회수 기능 -->
    <update id="viewsUp">
    	update BULLETINBOARD
        set VIEWS = VIEWS + 1
        where BOARD_ID= #{boardId}
    </update>
    
    <!-- 게시판 공지 사항만 보는 기능 -->
    <select id="selectAnnouncement" resultType="com.mid.alcohol.domain.Bulletinboard">
    	select * from BULLETINBOARD where CATEGORY = 1 order by BOARD_ID desc
    </select>
    
    <!-- 게시판 추천 높은순으로 나열하는 기능 -->
    <select id="selectOrderByRecommend" resultType="com.mid.alcohol.domain.Bulletinboard">
    	select * from BULLETINBOARD order by RECOMMEND desc
    </select>
    
    
    
</mapper>